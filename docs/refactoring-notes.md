# 리팩토링 과정 기록 (Refactoring Notes)

> **목적**: 프로젝트 진행 과정에서 발견한 설계 문제점과 리팩토링 과정을 기록하여
> 학습 내용을 정리하고 향후 비슷한 상황에서 참고할 수 있도록 합니다.

## 📝 기록 형식

각 리팩토링은 다음 형식으로 기록합니다:

```
## [날짜] 리팩토링 제목
**문제 상황**: 어떤 문제가 있었는지
**적용한 원칙/패턴**: SOLID 원칙이나 디자인 패턴
**변경 내용**: 구체적으로 무엇을 어떻게 바꾸었는지  
**결과**: 개선된 점과 트레이드오프
**학습 포인트**: 이번 리팩토링에서 배운 점
**커밋 해시**: git commit hash (나중에 추가)
```

---

## 리팩토링 기록

### [예정] 1단계 - 초기 도메인 모델 구현 후

*아직 리팩토링이 시작되지 않았습니다. 첫 번째 구현을 완료한 후 이 섹션을 업데이트하세요.*

**예상되는 리팩토링 포인트:**
- [ ] Money 클래스의 통화 처리 방식
- [ ] DateRange 검증 로직 위치
- [ ] Member와 MembershipPlan의 관계 설계
- [ ] 예외 처리 전략 정립

---

### [예정] 2단계 - SOLID 원칙 적용

**예상 리팩토링 항목:**

#### Single Responsibility Principle (SRP)
- [ ] 거대한 Member 클래스 분리
- [ ] 여러 역할을 하는 메서드 분해
- [ ] 데이터와 행위가 혼재된 클래스 정리

#### Open/Closed Principle (OCP)
- [ ] 할인 정책 확장을 위한 추상화
- [ ] 새로운 멤버십 타입 추가 대응
- [ ] 결제 방식 확장성 확보

#### Liskov Substitution Principle (LSP)
- [ ] 상속 관계의 계약 위반 수정
- [ ] 인터페이스 구현체의 동작 일관성

#### Interface Segregation Principle (ISP)
- [ ] 비대한 인터페이스 분리
- [ ] 클라이언트별 필요한 메서드만 노출

#### Dependency Inversion Principle (DIP)
- [ ] 고수준 모듈의 저수준 의존성 제거
- [ ] 추상화를 통한 의존성 역전

---

### [예정] 3단계 - 디자인 패턴 적용

#### Strategy Pattern
- [ ] **대상**: 할인 정책 계산 로직
- [ ] **문제**: if-else 조건문으로 할인 타입 분기
- [ ] **해결**: DiscountPolicy 인터페이스와 구현체들

#### Decorator Pattern
- [ ] **대상**: 다중 할인 조합
- [ ] **문제**: 할인 조합의 경우의 수 증가 시 복잡도 폭증
- [ ] **해결**: DiscountDecorator를 통한 조합

#### State Pattern
- [ ] **대상**: Reservation 상태별 행위 변경
- [ ] **문제**: 상태 체크와 행위 로직이 산재
- [ ] **해결**: ReservationState 인터페이스와 구현체들

#### Template Method Pattern
- [ ] **대상**: 결제 프로세스
- [ ] **문제**: 결제 방식별 중복 코드
- [ ] **해결**: 공통 프로세스 템플릿화

#### Factory Pattern
- [ ] **대상**: 복잡한 객체 생성 로직
- [ ] **문제**: 생성자가 복잡해지거나 생성 조건이 까다로움
- [ ] **해결**: 전용 팩토리 클래스

#### Specification Pattern
- [ ] **대상**: 복합 예약 조건 검증
- [ ] **문제**: 여러 조건의 조합이 복잡함
- [ ] **해결**: 조합 가능한 사양 객체들

---

### [예정] 4단계 - 테스트 개선을 위한 리팩토링

#### Test Double 적용을 위한 의존성 분리
- [ ] **문제**: 외부 의존성 때문에 테스트 어려움
- [ ] **해결**: 인터페이스 추출 및 Mock/Stub 활용

#### 테스트 용이성을 위한 캡슐화 조정
- [ ] **문제**: private 메서드가 많아서 테스트 포인트 부족
- [ ] **해결**: 테스트 가능한 단위로 메서드 재구성

#### Given-When-Then 구조를 위한 메서드 분리
- [ ] **문제**: 하나의 메서드에서 여러 일을 수행
- [ ] **해결**: 준비-실행-검증 단계별 메서드 분리

---

### [예정] 5단계 - 헥사고날 아키텍처 리팩토링

#### Port 인터페이스 추출
- [ ] **대상**: Repository, PaymentGateway, NotificationService
- [ ] **목적**: 도메인 로직의 외부 의존성 제거
- [ ] **방법**: Outbound Port 인터페이스 정의

#### Application Service 분리
- [ ] **대상**: 도메인 서비스의 애플리케이션 로직
- [ ] **목적**: 순수 도메인 로직과 애플리케이션 로직 분리
- [ ] **방법**: UseCase별 Application Service 생성

#### Adapter 구현
- [ ] **대상**: 구체적인 기술 구현체들
- [ ] **목적**: Port 인터페이스 구현
- [ ] **방법**: InMemory → Database/WebAPI Adapter 점진적 교체

---

## 🎯 리팩토링 체크리스트

### 코드 품질 지표
- [ ] **순환 복잡도**: 메서드당 10 이하 유지
- [ ] **클래스 응집도**: 하나의 책임에 집중
- [ ] **결합도**: 인터페이스 의존, 구현체 의존 최소화
- [ ] **중복 코드**: DRY 원칙 준수

### 설계 원칙 준수
- [ ] **불변성**: 값 객체는 불변, 엔티티도 가능한 불변
- [ ] **캡슐화**: 내부 구현 숨김, 행위를 통한 상태 변경
- [ ] **도메인 언어**: 비즈니스 용어가 코드에 그대로 반영
- [ ] **실패 빠르게**: 잘못된 상태 생성 시점에 차단

### 테스트 가능성
- [ ] **의존성 주입**: 외부 의존성 제어 가능
- [ ] **결정론적**: 같은 입력에 같은 출력
- [ ] **격리**: 다른 테스트의 영향 없음
- [ ] **빠른 피드백**: 단위 테스트 실행 시간 최소화

---

## 📊 리팩토링 메트릭

### 정량적 지표
| 지표 | 리팩토링 전 | 리팩토링 후 | 개선율 |
|------|------------|------------|--------|
| 클래스 수 | - | - | - |
| 메서드 평균 길이 | - | - | - |
| 순환 복잡도 | - | - | - |
| 테스트 커버리지 | - | - | - |
| 의존성 수 | - | - | - |

*실제 측정값은 리팩토링 진행 과정에서 업데이트*

### 정성적 지표
- [ ] **가독성**: 코드를 읽고 이해하기 쉬움
- [ ] **확장성**: 새로운 기능 추가가 용이함
- [ ] **유지보수성**: 버그 수정이나 요구사항 변경이 쉬움
- [ ] **테스트 용이성**: 단위 테스트 작성이 간단함

---

## 💡 학습한 리팩토링 원칙

### 점진적 리팩토링
- 한 번에 모든 것을 바꾸려 하지 말고 작은 단위로 나누어 진행
- 각 단계마다 테스트로 검증하여 동작 보장
- 리팩토링과 기능 추가를 동시에 하지 않기

### 테스트 주도 리팩토링
- 리팩토링 전에 기존 동작을 검증하는 테스트 작성
- 리팩토링 중에는 테스트가 깨지지 않도록 유지
- 리팩토링 후 새로운 설계에 맞는 테스트로 보완

### 도메인 중심 리팩토링
- 기술적 편의성보다 도메인 표현력 우선
- 비즈니스 용어와 개념이 코드에 명확히 드러나도록
- 도메인 전문가가 코드를 읽고 이해할 수 있는 수준으로

---

## 🔄 다음 리팩토링 계획

### 단기 (1-2주)
- [ ] 첫 번째 구현 완료 후 SOLID 원칙 적용
- [ ] 기본 디자인 패턴 (Strategy, State) 도입
- [ ] 단위 테스트 커버리지 80% 달성

### 중기 (1개월)
- [ ] 헥사고날 아키텍처로 전환
- [ ] 고급 패턴 (Specification, Decorator) 적용
- [ ] 동시성 이슈 대응

### 장기 (2-3개월)
- [ ] 성능 최적화
- [ ] 확장성 개선
- [ ] 스프링 도입 준비

---

**사용법**:
1. 리팩토링 전에 현재 문제점을 명확히 정의
2. 적용할 원칙/패턴을 선택하고 계획 수립
3. 작은 단위로 나누어 점진적 실행
4. 각 단계마다 이 문서에 기록
5. 회고를 통해 학습 포인트 정리